
-- SimpleSpy Mobile Basic - Version Simplifiée
-- Fonctionnalités : Espionne FireServer/InvokeServer, affiche dans la console, bouton de basculement mobile.

-- Vérifie si une instance est déjà en cours d'exécution et tente de l'arrêter
if _G.SimpleSpyExecuted and type(_G.SimpleSpyShutdown) == "function" then
    print("Arrêt de l'instance précédente de SimpleSpy...")
    pcall(_G.SimpleSpyShutdown)
end

-- Services
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- Variables de contrôle
local isEnabled = true -- État initial de l'espion
local originalNamecall -- Stocke la méthode __namecall originale
local originalFireServer -- Stocke FireServer originale
local originalInvokeServer -- Stocke InvokeServer originale
local gm = getrawmetatable(game) -- Récupère la metatable du jeu
setreadonly(gm, false) -- Rend la metatable modifiable

-- Création du bouton de basculement mobile
local ToggleButton = Instance.new("ImageButton")
ToggleButton.Name = "SimpleSpyToggleButton"
ToggleButton.Size = UDim2.new(0, 50, 0, 50)
ToggleButton.Position = UDim2.new(0, 100, 1, -100) -- En bas à gauche
ToggleButton.BackgroundColor3 = Color3.fromRGB(53, 52, 55)
ToggleButton.BorderSizePixel = 0
ToggleButton.Image = "rbxassetid://7072720870" -- Icône œil ouvert
ToggleButton.Visible = true
ToggleButton.ZIndex = 10
ToggleButton.Active = true
ToggleButton.Draggable = true -- Permet de déplacer le bouton

local Corner = Instance.new("UICorner")
Corner.CornerRadius = UDim.new(0, 8)
Corner.Parent = ToggleButton

-- Fonction pour basculer l'état de l'espion
local function toggleSpy()
    isEnabled = not isEnabled
    ToggleButton.Image = isEnabled and "rbxassetid://7072720870" or "rbxassetid://7072719338" -- Change l'icône
    print("SimpleSpy Basic:", isEnabled and "Activé" or "Désactivé")
end

-- Fonction pour arrêter proprement l'espion
local function shutdown()
    -- Restaure les méthodes originales
    if originalNamecall then
        gm.__namecall = originalNamecall
    end
    -- Note: hookfunction n'est pas utilisé dans cette version basique
    -- Supprime le bouton
    ToggleButton:Destroy()
    -- Met à jour l'indicateur global
    _G.SimpleSpyExecuted = false
    print("SimpleSpy Basic arrêté.")
end

-- Stocke les méthodes originales
originalNamecall = gm.__namecall

-- Hook de __namecall pour intercepter les appels
gm.__namecall = newcclosure(function(self, ...)
    local method = getnamecallmethod()
    local args = {...}

    -- Vérifie si l'espion est activé
    if isEnabled and typeof(self) == "Instance" then
        if method == "FireServer" or method == "fireServer" then
            -- Intercepte FireServer
            print(">>> [EVENT FIRED] " .. tostring(self:GetFullName()) .. " (FireServer)")
            for i, arg in ipairs(args) do
                print("      [" .. i .. "] " .. tostring(arg) .. " [" .. typeof(arg) .. "]")
            end
        elseif method == "InvokeServer" or method == "invokeServer" then
            -- Intercepte InvokeServer
            print(">>> [FUNCTION INVOKED] " .. tostring(self:GetFullName()) .. " (InvokeServer)")
            for i, arg in ipairs(args) do
                print("      [" .. i .. "] " .. tostring(arg) .. " [" .. typeof(arg) .. "]")
            end
        end
    end

    -- Appelle la méthode originale
    return originalNamecall(self, ...)
end)

-- Connecte le clic sur le bouton de basculement
ToggleButton.MouseButton1Click:Connect(toggleSpy)

-- Place le bouton dans l'interface utilisateur
if syn and syn.protect_gui then
    pcall(syn.protect_gui, ToggleButton)
end
ToggleButton.Parent = CoreGui

-- Définit la fonction d'arrêt globale
_G.SimpleSpyShutdown = shutdown

-- Indique que SimpleSpy est en cours d'exécution
_G.SimpleSpyExecuted = true

print("SimpleSpy Basic chargé. Cliquez sur le bouton en bas à gauche pour activer/désactiver.")
print("Les logs apparaîtront dans la console (F9).")

-- Restaure la protection en lecture seule de la metatable
setreadonly(gm, true)